name: Check CHANGELOG.md update

on:
  pull_request:
    paths:
      - '/version.txt'
  push:
    branches:
      - main
    paths:
      - '/version.txt'

jobs:
  changelog-update-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check if both specific files are modified
        run: |
          #!/bin/bash

          # Define your files
          FILE_A="/version.txt"
          FILE_B="/CHANGELOG.md"

          # Check if FILE_A is modified
          if  git diff --name-only ${{ github.event.before }} ${{ github.sha }} | grep -q "$FILE_A"; then
            echo "$FILE_A is modified."

            # Check if FILE_B is also modified
            if git diff --name-only ${{ github.event.before }} ${{ github.sha }} | grep -q "$FILE_B"; then
              echo "Both $FILE_A and $FILE_B are synced."
            else
              echo "::error::$FILE_B has not been updated. Please update $FILE_B as well with relevant info."
              exit 1
            fi
          fi
